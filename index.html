<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŒ‘æˆ˜ é»‘ç™½é£æš´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#06B6D4', // ç§‘æŠ€è“ä¸»è‰²
                        secondary: '#22D3EE', // äº®è“è‰²
                        accent: '#3B82F6', // å¼ºè°ƒè“
                        dark: '#0F172A', // æ·±è‰²èƒŒæ™¯
                        light: '#E0F2FE', // æµ…è‰²èƒŒæ™¯
                    },
                    fontFamily: {
                        game: ['"Press Start 2P"', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .pixel-border {
                box-shadow: 0 0 0 2px #0284C7;
            }
            .pixel-transition {
                transition: all 0.2s ease-in-out;
            }
            .pixel-hover {
                transform: scale(1.05);
                box-shadow: 0 0 10px rgba(6, 182, 212, 0.5);
            }
            .game-container {
                perspective: 1000px;
            }
            .pixel-cell {
                transition: transform 0.3s;
                position: relative;
            }
            .pixel-cell.selected {
                box-shadow: 0 0 15px rgba(6, 182, 212, 0.7);
                border: 2px solid #06B6D4;
            }
            .pixel-cell.dragging {
                opacity: 0.7;
                transform: scale(1.1) rotate(5deg);
                z-index: 100;
                box-shadow: 0 0 15px rgba(6, 182, 212, 0.7);
            }
            .success-animation {
                animation: pulse 1s infinite alternate;
            }
            @keyframes pulse {
                from { transform: scale(1); }
                to { transform: scale(1.1); }
            }
            .glow {
                box-shadow: 0 0 15px rgba(6, 182, 212, 0.7);
            }
            .move-animation {
                transition: transform 0.6s cubic-bezier(0.25, 0.1, 0.25, 1);
                z-index: 20;
                position: absolute;
            }
            .scale-in {
                animation: scaleIn 0.3s ease-out forwards;
            }
            @keyframes scaleIn {
                from { transform: scale(0); opacity: 0; }
                to { transform: scale(1); opacity: 1; }
            }
            /* âœ… æ ¸å¿ƒä¿®æ”¹1ï¼šä¸æ»‘åŒæ­¥ç‰¹æ•ˆ - æ¼‚ç§»+æ—‹è½¬åŒæ—¶è¿›è¡Œã€æ— æ–¹å—æ„Ÿ */
            .sync-drift-rotate {
                animation: syncDriftRotate 0.6s cubic-bezier(0.25, 0.1, 0.25, 1) forwards;
            }
            @keyframes syncDriftRotate {
                0% { transform: translate(0, 0) rotate(0deg); }
                100% { transform: translate(0, 0) rotate(90deg); }
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-sky-500/20 to-cyan-600/30 min-h-screen flex flex-col items-center justify-center p-4 font-sans">
    <div class="max-w-md w-full mx-auto">
        <!-- æ¸¸æˆæ ‡é¢˜å’Œæ§åˆ¶åŒº -->
        <div class="text-center mb-6">
            <h1 class="text-[clamp(1.5rem,5vw,2.5rem)] font-bold text-primary mb-2 tracking-tight text-shadow-lg">é»‘ç™½é£æš´</h1>
            <p class="text-sky-800 mb-4">ç‚¹å‡»ç¬¬ä¸€ä¸ªï¼Œå†ç‚¹ç¬¬äºŒä¸ªï¼Œåˆä½“åˆ›é€ çº¯è‰²æ–¹å—!</p>
            
            <div id="game-stats" class="hidden mb-4 flex justify-center items-center gap-4">
                <div class="bg-white/80 backdrop-blur-sm rounded-lg px-4 py-2 shadow-md border border-primary/20">
                    <span class="text-sky-700 text-sm">ç”¨æ—¶:</span>
                    <span id="timer" class="font-bold text-dark ml-1">00:00.00</span>
                </div>
            </div>
            
            <button id="start-btn" class="bg-primary hover:bg-primary/90 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50 glow">
                <i class="fa fa-play mr-2"></i>å¼€å§‹æ¸¸æˆ
            </button>
        </div>
        
        <!-- èƒœåˆ©æç¤º (é»˜è®¤éšè—) -->
        <div id="success-message" class="hidden fixed inset-0 bg-dark/80 backdrop-blur-sm flex items-center justify-center z-50">
            <div class="bg-white/90 backdrop-blur-md rounded-xl p-8 max-w-md w-full mx-4 text-center shadow-2xl transform transition-all border border-primary/30">
                <div class="text-5xl mb-4 text-secondary">ğŸ‰</div>
                <h2 class="text-2xl font-bold mb-2 text-dark">æ­å–œä½ !</h2>
                <p class="text-sky-700 mb-4">ä½ æˆåŠŸåˆ›é€ äº†çº¯è‰²åƒç´ å—!</p>
                <div class="text-xl font-bold mb-6">
                    ç”¨æ—¶: <span id="final-time" class="text-primary">00:00.00</span>
                </div>
                <button id="restart-btn" class="bg-primary hover:bg-primary/90 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-all duration-300 transform hover:scale-105 glow">
                    <i class="fa fa-refresh mr-2"></i>å†æ¥ä¸€æ¬¡
                </button>
            </div>
        </div>
        
        <!-- æ¸¸æˆç½‘æ ¼å®¹å™¨ -->
        <div id="game-container" class="game-container grid grid-cols-4 gap-4 bg-white/70 backdrop-blur-sm p-4 rounded-xl shadow-xl border border-primary/20 relative">
            <!-- åƒç´ å—å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <!-- æ¸¸æˆè§„åˆ™è¯´æ˜ -->
        <div class="mt-6 bg-white/80 backdrop-blur-sm p-4 rounded-lg shadow-md border border-primary/20">
            <h3 class="font-bold text-lg mb-2 text-dark">æ¸¸æˆè§„åˆ™</h3>
            <ul class="text-sky-700 space-y-1 text-sm">
                <li>â€¢ ç‚¹å‡»ç¬¬ä¸€ä¸ªåƒç´ å—ï¼Œå†ç‚¹å‡»ç¬¬äºŒä¸ªåƒç´ å—è¿›è¡Œåˆä½“</li>
                <li>â€¢ åˆä½“è§„åˆ™: åŒä½åƒç´ åŒè‰²åˆ™ä¸ºé»‘ï¼Œå¼‚è‰²åˆ™ä¸ºç™½</li>
                <li>â€¢ åˆä½“åï¼Œç›®æ ‡ä½ç½®æ˜¾ç¤ºç»“æœï¼ŒåŸä½ç½®å›¾å½¢åŸåœ°é¡ºæ—¶é’ˆæ—‹è½¬90åº¦</li>
                <li>â€¢ åˆ›é€ å‡ºå…¨é»‘æˆ–å…¨ç™½çš„åƒç´ å—å³å¯è·èƒœ</li>
            </ul>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // æ¸¸æˆçŠ¶æ€å˜é‡
            const gameState = {
                isPlaying: false,
                startTime: null,
                timerInterval: null,
                cells: [], // å­˜å‚¨æ‰€æœ‰åƒç´ å—æ•°æ®
                gridSize: 4, // 4x4ç½‘æ ¼
                pixelSize: 4, // æ¯ä¸ªåƒç´ å—æ˜¯4x4çš„åƒç´ 
                selectedCellIndex: null // é€‰ä¸­çš„ç¬¬ä¸€ä¸ªå•å…ƒæ ¼ç´¢å¼•
            };
            
            // DOMå…ƒç´ 
            const gameContainer = document.getElementById('game-container');
            const startBtn = document.getElementById('start-btn');
            const restartBtn = document.getElementById('restart-btn');
            const timerDisplay = document.getElementById('timer');
            const gameStats = document.getElementById('game-stats');
            const successMessage = document.getElementById('success-message');
            const finalTimeDisplay = document.getElementById('final-time');
            
            // åˆå§‹åŒ–æ¸¸æˆç½‘æ ¼
            function initializeGrid() {
                gameContainer.innerHTML = '';
                gameState.cells = [];
                gameState.selectedCellIndex = null;
                
                for (let row = 0; row < gameState.gridSize; row++) {
                    for (let col = 0; col < gameState.gridSize; col++) {
                        const index = row * gameState.gridSize + col;
                        const pixelData = generateRandomPixelData();
                        const cellElement = createPixelCell(index, pixelData);
                        gameContainer.appendChild(cellElement);
                        gameState.cells.push({
                            index,
                            row,
                            col,
                            data: pixelData,
                            element: cellElement
                        });
                    }
                }
                setupClickSelection();
            }
            
            // ç”Ÿæˆéšæœºçš„4x4åƒç´ æ•°æ® (0ä¸ºç™½ï¼Œ1ä¸ºé»‘)
            function generateRandomPixelData() {
                const data = [];
                for (let i = 0; i < gameState.pixelSize; i++) {
                    const row = [];
                    for (let j = 0; j < gameState.pixelSize; j++) {
                        row.push(Math.floor(Math.random() * 2));
                    }
                    data.push(row);
                }
                return data;
            }
            
            // å°†åƒç´ æ•°æ®å‘å³æ—‹è½¬90åº¦
            function rotatePixelData(data) {
                const size = data.length;
                const rotated = [];
                for (let i = 0; i < size; i++) {
                    rotated.push(new Array(size).fill(0));
                }
                for (let i = 0; i < size; i++) {
                    for (let j = 0; j < size; j++) {
                        rotated[i][j] = data[size - j - 1][i];
                    }
                }
                return rotated;
            }
            
            // åˆ›å»ºåƒç´ å—å…ƒç´ 
            function createPixelCell(index, pixelData) {
                const cell = document.createElement('div');
                cell.id = `cell-${index}`;
                cell.className = 'pixel-cell w-20 h-20 pixel-border rounded-md bg-sky-50 flex flex-wrap cursor-pointer pixel-transition hover:pixel-hover relative overflow-hidden';
                cell.setAttribute('data-index', index);
                
                for (let i = 0; i < gameState.pixelSize; i++) {
                    for (let j = 0; j < gameState.pixelSize; j++) {
                        const pixel = document.createElement('div');
                        const isBlack = pixelData[i][j] === 1;
                        pixel.className = `w-1/4 h-1/4 ${isBlack ? 'bg-slate-800' : 'bg-white'} border border-sky-200`;
                        pixel.setAttribute('data-row', i);
                        pixel.setAttribute('data-col', j);
                        cell.appendChild(pixel);
                    }
                }
                return cell;
            }
            
            // è®¾ç½®ç‚¹å‡»é€‰æ‹©åŠŸèƒ½
            function setupClickSelection() {
                const cells = document.querySelectorAll('.pixel-cell');
                cells.forEach(cell => {
                    cell.addEventListener('click', () => {
                        if (!gameState.isPlaying) return;
                        const currentIndex = parseInt(cell.getAttribute('data-index'));
                        if (gameState.selectedCellIndex === null) {
                            gameState.selectedCellIndex = currentIndex;
                            cell.classList.add('selected');
                        } else if (gameState.selectedCellIndex !== currentIndex) {
                            const prevSelectedCell = document.getElementById(`cell-${gameState.selectedCellIndex}`);
                            prevSelectedCell.classList.remove('selected');
                            mergePixelsWithAnimation(gameState.selectedCellIndex, currentIndex);
                            gameState.selectedCellIndex = null;
                        } else {
                            cell.classList.remove('selected');
                            gameState.selectedCellIndex = null;
                        }
                    });
                });
            }
            
            // å¸¦åŠ¨ç”»çš„åˆå¹¶ä¸¤ä¸ªåƒç´ å—
            function mergePixelsWithAnimation(sourceIndex, targetIndex) {
                const sourceCell = gameState.cells.find(cell => cell.index === sourceIndex);
                const targetCell = gameState.cells.find(cell => cell.index === targetIndex);
                if (!sourceCell || !targetCell) return;

                const sourceRect = sourceCell.element.getBoundingClientRect();
                const targetRect = targetCell.element.getBoundingClientRect();
                const containerRect = gameContainer.getBoundingClientRect();

                // å…‹éš†å—ç§»åŠ¨åŠ¨ç”»ï¼ˆä¸å½±å“åŸå—ï¼‰
                const clone = sourceCell.element.cloneNode(true);
                clone.id = `clone-${sourceIndex}`;
                clone.classList.add('move-animation');
                clone.style.position = 'absolute';
                clone.style.left = `${sourceRect.left - containerRect.left}px`;
                clone.style.top = `${sourceRect.top - containerRect.top}px`;
                clone.style.width = `${sourceRect.width}px`;
                clone.style.height = `${sourceRect.height}px`;
                gameContainer.appendChild(clone);

                const targetX = targetRect.left - containerRect.left;
                const targetY = targetRect.top - containerRect.top;
                setTimeout(() => {
                    clone.style.transform = `translate(${targetX - (sourceRect.left - containerRect.left)}px, ${targetY - (sourceRect.top - containerRect.top)}px)`;
                }, 10);

                // âœ… æ ¸å¿ƒä¿®æ”¹2ï¼šåŠ¨ç”»æ—¶åºç²¾å‡†å¯¹é½ + åŸå—å…¨ç¨‹ä¿ç•™ + æ•°æ®æ— ç¼æ›´æ–°
                setTimeout(() => {
                    clone.remove();
                    // è®¡ç®—åˆå¹¶ç»“æœ
                    const mergedData = [];
                    for (let i = 0; i < gameState.pixelSize; i++) {
                        const row = [];
                        for (let j = 0; j < gameState.pixelSize; j++) {
                            row.push(sourceCell.data[i][j] === targetCell.data[i][j] ? 1 : 0);
                        }
                        mergedData.push(row);
                    }
                    updatePixelCell(targetIndex, mergedData);
                    targetCell.data = mergedData;

                    // èƒœåˆ©åˆ¤æ–­
                    if (checkWinCondition(mergedData)) {
                        endGame();
                        return;
                    }

                    // âœ… å…³é”®ï¼šå…ˆåŠ åŠ¨ç”» â†’ åŒæ­¥è®¡ç®—æ—‹è½¬æ•°æ® â†’ åŠ¨ç”»ç»“æŸæ— ç¼æ›¿æ¢æ•°æ®ï¼ˆæ— é—ªçƒ/æ–¹å—æ„Ÿï¼‰
                    const rotatedData = rotatePixelData(sourceCell.data);
                    sourceCell.element.classList.add('sync-drift-rotate'); // ç«‹å³å¯åŠ¨åŒæ­¥ç‰¹æ•ˆ
                    // åŠ¨ç”»æ—¶é•¿å’ŒCSSå®Œå…¨ä¸€è‡´ï¼Œåšåˆ°ã€ŒåŠ¨ç”»ç»“æŸ=æ•°æ®æ›´æ–°ã€æ— ç¼è¡”æ¥
                    setTimeout(() => {
                        sourceCell.data = rotatedData;
                        updatePixelCell(sourceIndex, rotatedData);
                        sourceCell.element.classList.remove('sync-drift-rotate'); // æ¸…é™¤åŠ¨ç”»ç±»ï¼Œä¸å½±å“åç»­æ“ä½œ
                    }, 600);

                    // ç›®æ ‡å—åˆä½“åé¦ˆåŠ¨ç”»
                    const targetElement = document.getElementById(`cell-${targetIndex}`);
                    targetElement.classList.add('scale-110', 'bg-cyan-100');
                    setTimeout(() => {
                        targetElement.classList.remove('scale-110', 'bg-cyan-100');
                    }, 300);
                }, 600);
            }
            
            // æ›´æ–°åƒç´ å—æ˜¾ç¤º
            function updatePixelCell(index, data) {
                const cell = document.getElementById(`cell-${index}`);
                cell.innerHTML = '';
                for (let i = 0; i < gameState.pixelSize; i++) {
                    for (let j = 0; j < gameState.pixelSize; j++) {
                        const pixel = document.createElement('div');
                        const isBlack = data[i][j] === 1;
                        pixel.className = `w-1/4 h-1/4 ${isBlack ? 'bg-slate-800' : 'bg-white'} border border-sky-200 transition-colors duration-200`;
                        pixel.setAttribute('data-row', i);
                        pixel.setAttribute('data-col', j);
                        cell.appendChild(pixel);
                    }
                }
            }
            
            // æ£€æŸ¥èƒœåˆ©æ¡ä»¶ (å…¨é»‘æˆ–å…¨ç™½)
            function checkWinCondition(pixelData) {
                const allBlack = pixelData.every(row => row.every(pixel => pixel === 1));
                const allWhite = pixelData.every(row => row.every(pixel => pixel === 0));
                return allBlack || allWhite;
            }
            
            // å¼€å§‹æ¸¸æˆ
            function startGame() {
                gameState.isPlaying = true;
                gameState.startTime = new Date();
                gameStats.classList.remove('hidden');
                startBtn.classList.add('hidden');
                gameState.timerInterval = setInterval(updateTimer, 10);
                initializeGrid();
            }
            
            // ç»“æŸæ¸¸æˆ
            function endGame() {
                gameState.isPlaying = false;
                clearInterval(gameState.timerInterval);
                const endTime = new Date();
                const totalTime = endTime - gameState.startTime;
                finalTimeDisplay.textContent = formatTime(totalTime);
                
                const allCells = document.querySelectorAll('.pixel-cell');
                allCells.forEach(cell => {
                    const index = parseInt(cell.getAttribute('data-index'));
                    const cellData = gameState.cells.find(c => c.index === index).data;
                    if (checkWinCondition(cellData)) {
                        cell.classList.add('success-animation', 'border-4', 'border-secondary', 'glow');
                    }
                });
                
                setTimeout(() => {
                    successMessage.classList.remove('hidden');
                }, 500);
            }
            
            // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º (mm:ss.xx)
            function formatTime(ms) {
                const minutes = Math.floor(ms / 60000);
                const seconds = Math.floor((ms % 60000) / 1000);
                const centiseconds = Math.floor((ms % 1000) / 10);
                return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${centiseconds.toString().padStart(2, '0')}`;
            }
            
            // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
            function updateTimer() {
                if (!gameState.isPlaying) return;
                const currentTime = new Date();
                const elapsedTime = currentTime - gameState.startTime;
                timerDisplay.textContent = formatTime(elapsedTime);
            }
            
            // é‡å¯æ¸¸æˆ
            function restartGame() {
                successMessage.classList.add('hidden');
                startGame();
            }
            
            // äº‹ä»¶ç›‘å¬
            startBtn.addEventListener('click', startGame);
            restartBtn.addEventListener('click', restartGame);
        });
    </script>
</body>
</html>
